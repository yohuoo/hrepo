# 📚 HNode CRM 功能详细说明

## 🎯 功能概览

HNode CRM 是一个全功能的客户关系管理系统，集成了AI智能分析、邮件营销、销售管理和权限控制等功能。

---

## 📊 功能清单

### 1. 客户管理模块

| 功能 | 说明 | AI辅助 | 权限控制 |
|------|------|--------|---------|
| **联系人管理** | 存储和管理潜在联系人 | ❌ | ✅ 查看/新增/编辑/删除 |
| **Hunter.io搜索** | 根据域名批量获取公司联系人 | ❌ | ✅ Hunter搜索权限 |
| **联系人导出** | 批量导出联系人为CSV | ❌ | ✅ 查看权限 |
| **客户管理** | 管理正式客户，跟踪沟通进度 | ✅ AI分析 | ✅ 查看/新增/编辑/删除 |
| **客户AI分析** | 基于邮件和会议自动分析客户 | ✅ | ✅ AI分析权限 |
| **成交状态** | 标记客户为"已成交"/"未成交" | ❌ | ✅ 编辑权限 |
| **合同管理** | 录入和管理销售合同 | ✅ AI建议 | ✅ 录入/查看合同权限 |
| **兴趣度评级** | 评估客户兴趣程度 | ✅ AI建议 | ✅ 编辑权限 |

**客户AI分析包含**：
- 当前沟通进度分析
- 机会点识别（优先级标注）
- 风险点预警（严重性标注）
- 战略建议（预期结果）
- 下一步行动建议（时间线）

---

### 2. 邮件系统模块

| 功能 | 说明 | AI辅助 | 权限控制 |
|------|------|--------|---------|
| **收件箱** | 查看接收的邮件 | ✅ 翻译 | ✅ 页面访问 |
| **发件箱** | 查看已发送的邮件 | ✅ 翻译 | ✅ 页面访问 |
| **写邮件** | 撰写和发送邮件 | ✅ 翻译润色 | ✅ 页面访问 |
| **邮件模板** | 创建和管理可复用模板 | ✅ AI生成 | ✅ 创建/编辑/删除 |
| **个性化变量** | 自动替换收件人信息 | ✅ AI建议 | - |
| **批量发送** | 一次发送给多个联系人/客户 | ✅ 个性化 | ✅ 发送权限 |
| **智能翻译** | 中英文互译、内容润色 | ✅ | ✅ 使用权限 |
| **收件人选择** | 联系人和客户混合选择 | ❌ | ✅ 查看权限 |
| **邮件预览** | 发送前预览个性化后的内容 | ✅ 变量替换 | - |

**邮件AI功能**：
- AI生成邮件内容（营销、跟进、回复）
- 中文→英文翻译+润色
- 英文→中文翻译
- 个性化变量智能建议
- 回复邮件自动引用原文

---

### 3. 数据分析模块

| 功能 | 说明 | AI辅助 | 权限控制 |
|------|------|--------|---------|
| **数据统计** | 可视化数据仪表板 | ✅ 洞察+建议 | ✅ 页面访问 |
| **趋势图表** | 联系人、客户、销售趋势 | ❌ | - |
| **AI数据洞察** | 自动分析趋势并标注 | ✅ | - |
| **AI行动建议** | 基于数据提供行动方案 | ✅ | - |
| **部门筛选** | 按部门查看数据（管理员） | ❌ | ✅ 管理员角色 |
| **用户筛选** | 按用户查看数据（管理员） | ❌ | ✅ 管理员角色 |
| **销售数据** | 销售记录和统计 | ❌ | ✅ 新增/编辑/删除 |
| **数据报告** | AI生成数据分析报告 | ✅ | ✅ 生成/删除 |
| **案例总结** | 成交客户案例分析 | ✅ | ✅ 生成/查看/删除 |

**统计图表类型**：
- 📈 折线图：联系人、客户、销售趋势
- 🍩 饼图：客户兴趣度分布
- 📊 双Y轴图：销售金额和数量
- 🎯 动态布局：根据数据点数量自动调整

**AI数据洞察标注**：
- 🔴 红色下降箭头：严重下降趋势
- 🟢 绿色上升箭头：强劲上升趋势
- 🟡 黄色折线：剧烈波动
- ⚪ 无标注：正常波动

---

### 4. 会议管理模块

| 功能 | 说明 | AI辅助 | 权限控制 |
|------|------|--------|---------|
| **视频上传** | 上传会议录音视频 | ❌ | ✅ 上传权限 |
| **AI转录** | 自动语音转文字 | ✅ | - |
| **AI摘要** | 提取会议要点 | ✅ | - |
| **关联客户** | 会议关联到客户 | ❌ | - |
| **下载文字稿** | 导出会议文字稿 | ❌ | - |
| **下载AI摘要** | 导出Markdown格式摘要 | ❌ | - |

**支持的视频格式**：
- `.mp4` - 推荐
- `.mov` - 支持
- `.avi` - 支持
- `.webm` - 支持

**AI分析包含**：
- 会议主题总结
- 关键讨论点
- 客户关注点
- 行动项提取
- 风险和机会识别

---

### 5. 权限系统模块

| 功能 | 说明 | 仅超管 | 特点 |
|------|------|--------|------|
| **页面权限管理** | 配置用户/部门权限 | ✅ | 三级权限（菜单/页面/操作） |
| **部门权限继承** | 用户自动继承部门权限 | - | 简化管理 |
| **个人权限追加** | 为个人添加额外权限 | ✅ | 灵活授权 |
| **权限审计日志** | 记录所有权限变更 | ✅ | 可追溯 |
| **前端动态菜单** | 侧边栏根据权限显示 | - | 自动隐藏无权菜单 |
| **后端API拦截** | API调用权限检查 | - | 双重防护 |

**权限层级**：

```
一级：菜单（menu）
  ├─ 二级：页面（page）
  │    └─ 三级：操作（action）
  
示例：
客户管理（menu）
  ├─ 联系人（page）
  │    ├─ 查看联系人（action）
  │    ├─ 新增联系人（action）
  │    ├─ 编辑联系人（action）
  │    ├─ 删除联系人（action）
  │    └─ Hunter搜索（action）
  └─ 客户（page）
       ├─ 查看客户（action）
       ├─ 新增客户（action）
       ├─ 编辑客户（action）
       ├─ 删除客户（action）
       ├─ AI分析客户（action）
       ├─ 录入合同（action）
       └─ 查看合同（action）
```

**权限规则**：
- ✅ 勾选父级 → 自动勾选所有子级
- ✅ 取消父级 → 自动取消所有子级
- ✅ 部门权限 + 个人追加权限 = 最终权限
- ✅ 个人撤销权限 > 部门授予权限
- ✅ 超级管理员拥有所有权限（不受配置限制）

---

### 6. 系统设置模块

| 功能 | 说明 | 权限要求 |
|------|------|---------|
| **部门管理** | 创建和管理部门架构 | 超级管理员 |
| **用户管理** | 添加和管理用户账号 | 管理员+ |
| **邮箱配置** | 配置发件邮箱SMTP | 所有用户 |
| **页面权限** | 配置访问权限 | 仅超级管理员 |

---

## 🔑 权限配置示例

### 场景1：销售专员（限制最严格）

**权限配置**：
```
✅ 联系人：查看、新增、编辑（不能删除）
✅ 客户：查看、新增、编辑（不能删除）
✅ 邮件：收发、模板（不能删除模板）
✅ 数据统计：只能查看个人数据
❌ 部门管理：无权访问
❌ 用户管理：无权访问
❌ 删除操作：全部禁止
```

**结果**：
- 侧边栏只显示：联系人、客户、邮件、数据统计
- 操作菜单只有：查看、编辑（无删除按钮）
- 数据统计只能看自己的数据

---

### 场景2：销售经理（中等权限）

**权限配置**：
```
✅ 联系人：全部权限（查看、新增、编辑、删除、Hunter搜索）
✅ 客户：全部权限（含AI分析、合同管理）
✅ 邮件：全部权限
✅ 数据统计：可查看部门数据
✅ 销售数据：全部权限
✅ 报告生成：部门报告
✅ 案例总结：查看和生成
❌ 部门管理：无权
❌ 用户管理：无权
❌ 页面权限：无权
```

**结果**：
- 可以使用大部分功能
- 可以管理部门销售团队的数据
- 可以生成部门级别的报告

---

### 场景3：管理员（高权限）

**权限配置**：
```
✅ 所有业务功能：全部权限
✅ 用户管理：可以管理
✅ 部门管理：可以查看（不能修改）
❌ 页面权限：无权（仅超管）
```

---

### 场景4：财务部门（特殊场景）

**权限配置**：
```
✅ 客户：只能查看
✅ 合同：查看合同列表
✅ 销售数据：全部权限
✅ 数据统计：查看全公司数据
✅ 数据报告：生成公司报告
❌ 联系人：无权
❌ 邮件：无权
❌ 会议：无权
```

**结果**：
- 专注于销售数据和合同管理
- 不干扰销售人员的日常工作

---

## 🤖 AI功能详解

### 1. 邮件AI辅助

**功能1：AI生成邮件内容**
- 输入：客户信息、邮件类型（营销/跟进/回复）
- 输出：专业的英文邮件内容
- 特点：自动添加个性化变量

**功能2：智能翻译**
- 中文 → 英文：翻译+商务润色
- 英文 → 中文：翻译+本地化
- 英文 → 英文：语法润色

**功能3：回复邮件**
- 自动引用原邮件标题和内容
- 生成得体的回复内容
- 保持沟通上下文

### 2. 客户AI分析

**分析维度**：
1. **沟通进度判断**
   - 关系阶段（初次接触/需求澄清/商务谈判/成交跟进）
   - 关系温度（冷/温/热）
   - 沟通节奏评估
   - 会议安排情况

2. **机会点识别**
   - 高/中/低优先级分类
   - 具体机会描述
   - 建议行动

3. **风险点预警**
   - 严重/一般风险分类
   - 风险描述
   - 应对建议

4. **战略建议**
   - 具体策略
   - 预期结果
   - 实施建议

5. **行动项**
   - 紧急/重要/一般优先级
   - 具体行动
   - 截止时间

### 3. 合同AI建议

**自动分析**：
- 历史邮件往来
- 销售记录
- 客户基本信息

**AI建议内容**：
- 甲方名称（客户公司）
- 乙方名称（浩天药业有限公司）
- 采购商品（从邮件提取）
- 采购数量（历史销售数据）
- 合同金额（历史价格）
- 预计交付时间

### 4. 数据洞察AI

**分析内容**：
- 联系人增长趋势
- 客户转化率
- 邮件互动效果
- 销售业绩变化

**输出格式**：
- 🔴 严重下降：需立即关注
- 🟢 强劲上升：值得继续加强
- 🟡 剧烈波动：需要分析原因
- ⚪ 正常波动：保持现状

### 5. 案例总结AI

**自动生成**：
- 客户基本信息
- 销售流程关键点
- 沟通亮点
- 销售技巧总结
- 成功经验提炼

**用途**：
- 团队学习
- 新人培训
- 经验复用

---

## 📝 数据流程图

### 客户跟进完整流程

```
1. 添加联系人
   ├─ Hunter.io搜索
   └─ 手动添加

2. 升级为客户
   ├─ 发送营销邮件
   └─ 标记为"客户"

3. 跟进沟通
   ├─ 邮件往来（AI翻译）
   ├─ 视频会议（AI转录）
   └─ 更新兴趣度

4. AI分析
   ├─ 自动分析沟通记录
   ├─ 识别机会和风险
   └─ 给出战略建议

5. 成交转化
   ├─ 标记"已成交"
   ├─ 录入合同（AI建议）
   └─ 自动创建销售记录

6. 案例总结
   ├─ AI分析成交过程
   ├─ 提炼销售技巧
   └─ 生成案例文档
```

---

## 🎨 个性化变量说明

### 可用变量

| 变量 | 说明 | 示例值 |
|------|------|--------|
| `{{firstName}}` | 名字 | Jerry |
| `{{lastName}}` | 姓氏 | Son |
| `{{company}}` | 公司名称 | ABC Company |
| `{{email}}` | 邮箱地址 | jerry@abc.com |
| `{{position}}` | 职位 | CEO |
| `{{domain}}` | 公司域名 | abc.com |

### 使用示例

**邮件模板**：
```
Dear {{firstName}},

I hope this email finds you well. I noticed that {{company}} 
is in the {{industry}} industry...

Best regards,
Your Name
```

**自动替换后**：
```
Dear Jerry,

I hope this email finds you well. I noticed that ABC Company 
is in the food industry...

Best regards,
Your Name
```

---

## 📊 统计数据说明

### 时间范围

- **今日**：当天0点至当前时间
- **7天**：最近7天（包括今天）
- **30天**：最近30天
- **3个月**：最近3个月
- **6个月**：最近6个月
- **全部**：所有历史数据
- **自定义**：选择开始和结束日期

### 数据维度

**新增联系人**：
- 总数
- 日趋势
- 标签分布

**新增客户**：
- 总数
- 日趋势
- 沟通进度分布
- 兴趣度分布

**邮件互动**：
- 发送数量
- 接收数量
- 回复率
- 日趋势

**销售数据**：
- 总交易笔数
- 总销售金额
- 总销售数量
- 日趋势（金额+数量）
- 按产品统计

### 筛选规则

**按用户筛选**：
- 只显示该用户的数据
- 适用于：个人业绩查看

**按部门筛选**：
- 显示部门及子部门所有用户的数据
- 适用于：部门经理查看团队业绩

**全部数据**：
- 超级管理员：所有数据
- 管理员：所在部门及子部门数据
- 普通用户：仅个人数据

---

## 🔒 安全特性

### 认证机制

- JWT Token认证
- Token有效期：7天（可配置）
- 自动刷新Token
- 登出后Token失效

### 密码安全

- bcrypt加密存储
- 密码强度要求：至少8位
- 首次登录强制修改密码
- 密码修改记录

### 权限防护

**前端防护**：
- 无权限菜单不显示
- 无权限按钮不显示
- 用户体验友好

**后端防护**（核心）：
- 所有API都经过权限检查
- 即使绕过前端也无法访问
- 返回403错误

**双重拦截**：
```
用户请求 
  → 前端检查（UI隐藏）
  → 后端检查（API拦截）
  → 数据库查询（用户ID过滤）
```

---

## 📈 性能优化

### 缓存策略

**Redis缓存**：
- 用户权限缓存（1小时）
- 会话信息缓存
- 权限变更自动清除缓存

### 数据库优化

**索引优化**：
- 70+个索引
- 覆盖所有查询字段
- 优化联表查询

**查询优化**：
- 分页查询（避免一次加载全部）
- 按需加载（用户数据隔离）
- 异步AI分析（不阻塞页面显示）

---

## 🎯 最佳实践

### 1. 权限配置建议

✅ **推荐**：
- 新用户默认给最小权限
- 通过部门配置权限（集中管理）
- 个人权限只在特殊情况使用
- 定期review权限审计日志

❌ **不推荐**：
- 给所有人超级管理员权限
- 频繁修改个人权限
- 不看审计日志

### 2. 数据管理建议

✅ **推荐**：
- 定期备份数据库
- 使用标签分类联系人
- 及时更新客户状态
- 定期生成数据报告

❌ **不推荐**：
- 长期不清理无效联系人
- 不更新客户兴趣度
- 忽视AI分析建议

### 3. AI功能使用建议

✅ **推荐**：
- 发送重要邮件前使用AI润色
- 查看客户详情时认真阅读AI分析
- 定期查看AI行动建议
- 参考AI合同建议（但要核对）

❌ **不推荐**：
- 完全依赖AI（需人工判断）
- 不核对AI生成的合同信息
- 忽视AI风险预警

---

## 📞 技术支持

如有问题，请查看：
- 📖 [README.md](./README.md) - 完整文档
- 🚀 [QUICK_START.md](./QUICK_START.md) - 快速开始
- 🐳 [DOCKER_GUIDE.md](./DOCKER_GUIDE.md) - Docker指南
- 📡 [API_DOCUMENTATION.md](./API_DOCUMENTATION.md) - API文档

---

**版本：v1.2.0** | **最后更新：2025-10-11**

