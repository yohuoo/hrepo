# 🎉 新功能使用指南

## 版本：v2.0.0 (2025-10-10)

本次更新新增了完整的**部门管理、用户权限、销售数据和AI报告**系统。

---

## 📋 目录

1. [新增功能概览](#新增功能概览)
2. [首次登录流程](#首次登录流程)
3. [部门管理](#部门管理)
4. [用户管理](#用户管理)
5. [销售数据管理](#销售数据管理)
6. [数据统计分析](#数据统计分析)
7. [AI报告生成](#ai报告生成)
8. [权限说明](#权限说明)

---

## 🆕 新增功能概览

### ✨ 核心功能

| 功能模块 | 说明 | 访问路径 |
|---------|------|---------|
| 🏢 **部门管理** | 多级部门树形结构管理 | `/settings/departments` |
| 👥 **用户管理** | 用户创建、编辑、密码管理 | `/settings/users` |
| 💰 **销售数据** | 销售记录管理和统计 | `/sales` |
| 📊 **数据统计** | 可视化数据分析仪表板 | `/statistics` |
| 📑 **AI报告** | 智能生成工作报告 | `/reports` |

### 🔐 权限体系

**三种角色：**
- 🔴 **超级管理员** (super_admin) - 全部权限
- 🟡 **管理员** (admin) - 部门管理权限
- 🔵 **普通用户** (user) - 个人数据权限

---

## 🚪 首次登录流程

### 步骤 1: 使用默认账号登录

访问：http://127.0.0.1:8000/login

```
用户名: admin
密码:   Admin123456
角色:   超级管理员
```

### 步骤 2: 强制修改密码

登录后系统会**自动跳转**到修改密码页面：

```
当前密码: Admin123456
新密码:   [输入至少8位的新密码]
确认密码: [再次输入新密码]
```

**重要提示：**
- ⚠️ 不修改密码无法使用系统其他功能
- ⚠️ 所有使用默认密码的用户首次登录都需要修改
- ✅ 修改成功后自动跳转到控制台

### 步骤 3: 开始使用系统

密码修改成功后，您可以：
1. ✅ 创建部门
2. ✅ 添加用户
3. ✅ 使用所有功能

---

## 🏢 部门管理

**访问路径：** 系统设置 → 部门管理

### 功能特性

#### 1️⃣ 部门树形结构

**支持多级部门（无限层级）：**

```
公司
├─ 销售部
│  ├─ 销售一组
│  ├─ 销售二组
│  └─ 海外销售组
├─ 技术部
│  ├─ 研发组
│  └─ 测试组
└─ 市场部
```

**每个部门显示：**
- 部门名称
- 部门主管
- 成员数量
- 子部门数量

#### 2️⃣ 创建部门

**步骤：**
1. 点击"添加部门"按钮
2. 填写信息：
   - 部门名称（必填）
   - 上级部门（可选，不选则为顶级部门）
   - 部门主管（可选）
   - 部门描述（可选）
3. 保存

**示例：**
```
部门名称: 销售一组
上级部门: 销售部
部门主管: 张三
部门描述: 负责国内客户销售
```

#### 3️⃣ 编辑/删除部门

**编辑：** 点击部门右侧的"铅笔"图标

**删除限制：**
- ❌ 有子部门的部门无法删除
- ❌ 有成员的部门无法删除
- ✅ 需先转移成员或删除子部门

#### 4️⃣ 查看部门详情

**点击"眼睛"图标，显示：**
- 部门基本信息
- 部门层级路径
- 部门成员列表（含子部门）
- 每个成员的角色和邮箱

---

## 👥 用户管理

**访问路径：** 系统设置 → 用户管理

### 功能特性

#### 1️⃣ 用户列表

**筛选功能：**
- 🔍 搜索用户名或邮箱
- 🏢 按部门筛选
- 👤 按角色筛选

**列表显示：**
- 用户名、邮箱
- 所属部门
- 角色（超级管理员/管理员/普通用户）
- 密码状态（已修改/未修改）
- 账号状态（激活/禁用）

#### 2️⃣ 创建用户

**权限要求：**
- 超级管理员：可创建所有角色
- 管理员：只能创建普通用户

**步骤：**
1. 点击"添加用户"
2. 填写信息：
   - 用户名（必填）
   - 邮箱（必填）
   - 部门（可选）
   - 角色（必填）
3. 保存

**自动设置：**
- 默认密码：`Admin123456`
- 密码状态：未修改
- 首次登录：强制修改密码

#### 3️⃣ 重置密码

**功能：** 将用户密码重置为 `Admin123456`

**权限：**
- 超级管理员：可重置任何用户
- 管理员：只能重置本部门的普通用户
- 普通用户：无权限

**重置后：**
- 密码变为：`Admin123456`
- 密码状态：未修改
- 用户下次登录：强制修改密码

---

## 💰 销售数据管理

**访问路径：** 数据分析 → 销售数据

### 功能特性

#### 1️⃣ 销售统计卡片

实时显示：
- 💵 销售总额
- 📝 销售记录数
- 🏢 客户数
- 📦 销售数量

#### 2️⃣ 添加销售记录

**必填字段：**
- 销售日期
- 客户（从客户列表选择）
- 产品名称（如：PQQ、甜叶菊）
- 销售数量
- 销售金额（USD）

**可选字段：**
- 备注

**示例：**
```
销售日期: 2025-10-10
客户: ABC公司 - 张三
产品名称: PQQ
销售数量: 100 kg
销售金额: $5000
备注: 首次合作
```

#### 3️⃣ 销售记录管理

- ✅ 查看销售记录列表
- ✅ 按日期范围筛选
- ✅ 编辑销售记录
- ✅ 删除销售记录

**权限：**
- 普通用户：只能管理自己的销售记录
- 管理员：可查看本部门的销售数据
- 超级管理员：可查看所有销售数据

---

## 📊 数据统计分析

**访问路径：** 数据分析 → 数据统计

### 功能特性

#### 1️⃣ 数据概览卡片

**4个核心指标：**
- 📇 新增联系人数
- 🏢 新增客户数
- 📧 邮件互动数（发送/接收）
- 💰 销售总额

**可点击：**
- 点击卡片 → 查看详细数据列表

#### 2️⃣ 时间范围筛选

**预设范围：**
- 今日
- 7天
- 30天
- 3个月
- 6个月

**自定义范围：**
- 选择开始日期
- 选择结束日期

#### 3️⃣ 数据可视化

**📈 折线图 - 联系人增长趋势**
- 显示每日新增联系人数量
- 趋势分析

**🥧 饼图 - 客户兴趣度分布**
- 🟢 高兴趣客户占比
- 🟡 中等兴趣客户占比
- 🔴 低兴趣客户占比

**数据权限：**
- 超级管理员：查看所有数据
- 管理员：查看本部门数据
- 普通用户：只看个人数据

---

## 📑 AI报告生成

**访问路径：** 数据分析 → 数据报告

### 功能特性

#### 1️⃣ 报告类型

**个人报告：**
- 查看个人工作表现
- 管理员可生成下属的个人报告
- 包含：联系人、客户、邮件、销售数据

**部门报告：**
- 仅管理员及以上可生成
- 汇总部门整体数据
- 包含团队协作分析

**公司报告：**
- 仅超级管理员可生成
- 全公司业绩总览
- 高管视角分析

#### 2️⃣ 报告周期

**周报：**
- 选择年份和周数
- 如：2025年第40周

**月报：**
- 选择年份和月份
- 如：2025年10月

#### 3️⃣ 生成报告

**步骤：**
1. 选择报告类型（个人/部门/公司）
2. 选择周期类型（周报/月报）
3. 选择时间（年月或年周）
4. 如果是部门报告，选择目标部门
5. 点击"生成报告"
6. 等待AI生成（约10-30秒）
7. 自动显示报告详情

**AI报告包含：**
- 📊 数据概览
- 💼 工作亮点
- ⚠️ 需要改进
- 📈 趋势分析
- 💡 下期建议

#### 4️⃣ 报告缓存

**智能缓存机制：**
- 每个月/周只生成一次报告
- 重新生成会覆盖旧报告
- 避免重复调用AI API
- 节省成本和时间

#### 5️⃣ 下载报告

**功能：**
- 点击"下载报告"按钮
- 生成 `.md` 文件
- 文件名：`个人报告_2025年10月.md`
- Markdown格式，可用任何编辑器打开

---

## 🔐 权限说明

### 角色对比表

| 功能 | 超级管理员 | 管理员 | 普通用户 |
|------|-----------|--------|---------|
| **部门管理** |
| 创建/编辑/删除部门 | ✅ | ❌ | ❌ |
| 查看部门树 | ✅ | ✅ | ✅ |
| 查看部门详情 | ✅ | ✅ | ✅ |
| **用户管理** |
| 创建超级管理员 | ✅ | ❌ | ❌ |
| 创建管理员 | ✅ | ❌ | ❌ |
| 创建普通用户 | ✅ | ✅ | ❌ |
| 重置任何用户密码 | ✅ | ❌ | ❌ |
| 重置本部门用户密码 | ✅ | ✅ | ❌ |
| 修改自己密码 | ✅ | ✅ | ✅ |
| **数据查看** |
| 查看所有数据 | ✅ | ❌ | ❌ |
| 查看本部门数据 | ✅ | ✅ | ❌ |
| 查看个人数据 | ✅ | ✅ | ✅ |
| **销售管理** |
| 添加销售记录 | ✅ | ✅ | ✅ |
| 编辑自己的记录 | ✅ | ✅ | ✅ |
| 查看部门销售数据 | ✅ | ✅ | ❌ |
| **报告生成** |
| 公司报告 | ✅ | ❌ | ❌ |
| 任意部门报告 | ✅ | ❌ | ❌ |
| 本部门报告 | ✅ | ✅ | ❌ |
| 他人个人报告 | ✅ | ✅(本部门) | ❌ |
| 自己个人报告 | ✅ | ✅ | ✅ |

---

## 🎯 使用场景示例

### 场景 1: 公司初始化

**超级管理员操作：**

1️⃣ **创建部门结构**
```
公司
├─ 销售部（主管：李经理）
│  ├─ 销售一组（主管：张组长）
│  └─ 销售二组（主管：王组长）
└─ 技术部（主管：刘经理）
```

2️⃣ **创建用户账号**
```
张三 - sales1@company.com - 销售一组 - 普通用户
李四 - sales2@company.com - 销售二组 - 普通用户
王五 - admin1@company.com - 销售部 - 管理员
```

3️⃣ **通知用户登录**
- 发送账号信息给新用户
- 告知默认密码：`Admin123456`
- 提醒首次登录需要修改密码

---

### 场景 2: 日常销售记录

**销售人员操作：**

1️⃣ **记录销售数据**
```
日期: 2025-10-10
客户: ABC Corp
产品: PQQ
数量: 100 kg
金额: $5000
```

2️⃣ **查看个人统计**
- 访问"数据统计"页面
- 查看本月销售业绩
- 查看客户增长趋势

3️⃣ **生成个人月报**
- 访问"数据报告"页面
- 选择"个人报告" + "月报" + "2025年10月"
- 点击"生成报告"
- 查看AI分析的工作表现

---

### 场景 3: 部门管理

**部门主管（管理员）操作：**

1️⃣ **添加部门成员**
```
姓名: 新员工
邮箱: new@company.com
部门: 销售一组
角色: 普通用户
```

2️⃣ **查看部门数据**
- 访问"数据统计"
- 查看本部门整体业绩
- 对比团队成员表现

3️⃣ **生成部门月报**
- 选择"部门报告"
- 选择自己管理的部门
- 生成本月部门总结
- 下载并发送给上级

4️⃣ **重置员工密码**
- 如员工忘记密码
- 点击"重置密码"
- 密码重置为 `Admin123456`
- 通知员工登录后修改

---

### 场景 4: 公司运营分析

**超级管理员操作：**

1️⃣ **查看全公司数据**
- 所有部门的业绩对比
- 整体销售趋势
- 客户增长情况

2️⃣ **生成公司月报**
- 选择"公司报告"
- 选择当月
- AI生成公司级别的运营分析
- 包含战略建议

3️⃣ **管理组织架构**
- 调整部门结构
- 设置部门主管
- 创建新部门

---

## 📱 页面导航

### 新增菜单结构

```
📊 控制台
  └─ 海外客户搜索

👥 客户管理
  ├─ 联系人
  └─ 客户

📧 邮件系统
  ├─ 收件箱
  ├─ 发件箱
  ├─ 写邮件
  └─ 邮件模板

📈 数据分析 ★ 新增
  ├─ 数据统计 ★ 新增
  ├─ 销售数据 ★ 新增
  └─ 数据报告 ★ 新增

🔧 其他
  └─ 会议记录

⚙️ 系统设置
  ├─ 部门管理 ★ 新增
  ├─ 用户管理 ★ 新增
  └─ 邮箱配置
```

---

## 🔧 开发者信息

### 新增API端点

**完整列表：**

```bash
# 部门管理
GET    /api/departments/tree
GET    /api/departments/:id
POST   /api/departments
PUT    /api/departments/:id
DELETE /api/departments/:id
GET    /api/departments/:id/members

# 用户管理
GET    /api/users
POST   /api/users
PUT    /api/users/:id
POST   /api/users/:id/reset-password
POST   /api/users/change-password
GET    /api/users/password-status

# 销售数据
GET    /api/sales
POST   /api/sales
PUT    /api/sales/:id
DELETE /api/sales/:id
GET    /api/sales/statistics

# 数据统计
GET    /api/statistics/dashboard
GET    /api/statistics/contacts
GET    /api/statistics/customers

# AI报告
POST   /api/reports/personal
POST   /api/reports/department/:deptId
POST   /api/reports/company
GET    /api/reports
GET    /api/reports/:id
```

### 数据库变更

**新增表：**
1. `departments` - 部门表
2. `sales_records` - 销售记录表
3. `reports` - 报告表

**修改表：**
1. `users` - 新增5个字段：
   - `department_id` - 所属部门
   - `role` - 角色
   - `password_changed` - 密码修改状态
   - `last_password_change` - 最后修改时间

---

## ❓ 常见问题

### Q1: 忘记密码怎么办？

**答：** 找管理员重置密码
1. 联系您的部门主管或超级管理员
2. 管理员在"用户管理"中点击"重置密码"
3. 密码重置为 `Admin123456`
4. 使用默认密码登录后修改

---

### Q2: 首次登录一定要改密码吗？

**答：** 是的，这是强制的安全措施
- ✅ 保护账户安全
- ✅ 防止默认密码泄露
- ✅ 不修改无法使用系统功能

---

### Q3: 为什么看不到某些菜单？

**答：** 根据角色显示不同功能
- 普通用户：看不到"部门管理"和"用户管理"
- 管理员：看不到某些超级管理员功能
- 使用正确角色的账号登录

---

### Q4: 如何查看其他用户的数据？

**答：** 取决于您的角色
- 超级管理员：可查看所有人
- 管理员：只能查看本部门成员
- 普通用户：只能查看自己

---

### Q5: AI报告生成失败怎么办？

**可能原因：**
1. OpenAI API配置错误
2. API配额不足
3. 网络连接问题

**降级方案：**
- 系统会自动生成基础报告
- 包含所有统计数据
- 只是没有AI分析部分

---

## 🚀 快速测试

### 测试清单

**基础功能：**
- [ ] 登录成功
- [ ] 强制修改密码
- [ ] 修改密码后进入系统

**部门管理：**
- [ ] 创建顶级部门
- [ ] 创建子部门
- [ ] 编辑部门
- [ ] 查看部门详情

**用户管理：**
- [ ] 创建普通用户
- [ ] 创建管理员（仅超管）
- [ ] 重置用户密码
- [ ] 查看用户列表

**销售数据：**
- [ ] 添加销售记录
- [ ] 查看销售统计
- [ ] 编辑销售记录
- [ ] 删除销售记录

**数据统计：**
- [ ] 查看数据卡片
- [ ] 切换时间范围
- [ ] 查看图表

**AI报告：**
- [ ] 生成个人月报
- [ ] 查看历史报告
- [ ] 下载报告

---

## 📞 技术支持

如有问题，请参考：
- 📖 完整文档：[README.md](./README.md)
- 🔧 API文档：[API_DOCUMENTATION.md](./API_DOCUMENTATION.md)
- 🚀 部署指南：[DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md)

---

## 🎊 开始使用

```bash
# 1. 启动服务
cd hnode
docker-compose up -d

# 2. 访问系统
open http://127.0.0.1:8000

# 3. 登录
用户名: admin
密码:   Admin123456

# 4. 修改密码
按照提示修改为您的新密码

# 5. 开始使用
创建部门 → 添加用户 → 记录销售 → 生成报告
```

**祝您使用愉快！** 🎉

